[쉽게 배우는 데이터 통신과 컴퓨터 네트워크] 책을 읽고 요약한 내용

# Overview
- 시스템과 전송 매체의 연결 지점에 대한 규격을 **인터페이스**라고 한다.
- 시스템이 데이터를 교환할 때 **프로토콜**이라는 통신 규칙에 따른다.
- 데이터를 소위 **PDU**라는 특정 형태로 규격화한다. 네트워크 계층에서는 **패킷**, 데이터 링크 계층에서는 **프레임**이라는 용어로 사용된다.
- 주소는 유일성/확장성/편리성/함축성의 특징을 갖는다.
- **IP 주소**는 네트워크 계층의 기능을 담당하는 IP 프로토콜이 호스트를 구분하기 위해 사용하는 주소 체계이다. 32비트의 binary 숫자로 구성되는데 보통 8비트씩 네 부분을 나누어 xxx.xxx.xxx.xx형식으로 사용된다. 

- 일다대 통신에서 특정 네트워크에 연결된 모든 호스트에 데이터를 전송할 수 있는 **브로드캐스팅**이 있고, 사용자를 그룹으로 묶어서 지칭하는 **멀티 캐스팅**이 있다.

오류 제어
- 데이터 송수신 과정에서 오류가 발생할 수 있는데, 데이터가 깨져서 도착하는 **데이터 변형 오류**와 데이터가 유실되는 **데이터 분실 오류**가 있다. 

흐름 제어
- 송수신 호스트 사이에서 데이터 전송/처리 속도 차이 때문에 데이터가 분실되기도 한다. 수신 호스트의 버퍼 처리 속도보다 송신 호스트에서 데이터를 전송하는 속도가 빠르면 분실 오류가 발생하므로 전송 속도를 조절하는 흐름 제어 기능이 필요하다.

서비스 프리미티브
- 프로토콜은 계층에 따라 구성되고, 하위 계층이 상위 계층에 제공하는 방식인데 이는 **프리미티브** 형태로 구현된다. 연결형 서비스에는 CONNECT/DISCONNECT/DATA가 있다. 통신에서는 클라이언트가 서버에 요청하는 Request/Indication으로 구현되고, 서버의 응답은 Response/Confirm으로 구현된다.

OSI 7계층 모델
- 네트워크에 연결된 호스트는 7개 계층(물리 계층/데이터 링크 계층/네트워크 계층/전송 계층/세션 계층/표현 계층/응용 계층)에 따른 통신 기능을 맞춰야 한다.
- 데이터 전송은 송신 호스트의 응용 계층에서 시작하여 하위 계층으로 순차적으로 전달되어 마지막에 물리 계층이 수신 호스트에 전달해주는 과정을 거친다. 수신 호스트에서는 바낻로 상위 계층으로 순차적으로 데이터를 이동시켜 응용 계층에 전달한다.
- OSI 7 계층 모델의 각 계층에선 목적에 따라 사용하는 주소의 형태가 다를 수 있다. *MAC 주소*는 데이터 링크 계층에서 사용하며 보통 LAN 카드에 내장되어 있다. *IP 주소*는 네트워크 계층에서 사용되며 라우팅의 기준이 된다. *포트 주소*는 전송 계층에서 사용되며 호스트에서 실행 중인 프로세스를 구분해준다. *메일 주소*는 응용 계층의 메일 시스템에서 사용되는 예다.

TCP/IP 모델
- 인터넷은 IP프로토콜을 사용하는 네트워크이다. 네트워크 구현 모델은 전송 계층까지의 기능을 운영체제 내부에 구현한다. TCP, UDP는 커널 내부에 구현되어 **소켓 인터페이스**라는 전송 계층의 프리미티브를 사용자 프로그램(세션계층 ~ 응용계층)에서 호출하는 방식으로 사용된다. 
- 데이터 링크 계층(계층2)에서 사용하는 MAC 주소, 네트워크 계층(계층3)에서 사용하는 IP 주소, 전송 계층(계층4)에서 사용하는 포트 번호를 주소로 사용한다. 

ARP/RARP
- 데이터를 전송하기 위해 수신자의 MAC 주소가 필요한데 **ARP**를 통해 상대 호스트의 IP 주소를 이용해 MAC 주소를 획득한다.
- 하드 디스크가 없는 시스템은 LAN 카드를 내장된 MAC 주소를 알 수 있지만 파일 시스템이 없으므로 IP 주소를 알 수 없다. 이 때 MAC 주소를 IP 주소로 변환해주는 시스템이 **RARP**이다.

ICMP
- **ICMP**은 전송 오류가 발생하면 송신자에게 회신하여 복구 작업을 진행한다. 오류 메시지를 전송하기 위한 별도의 헤더를 가지며 IP와 같은 계층으로 취급된다.

교환 시스템
- **교환 시스템**은 데이터를 최종 목적지까지 중개하는 교환 기능을 제공한다. 
- **회선 교환 방식**은 고정 대역으로 할당된 연결을 생성하여 전송하여 전송률이 안정적이다. 
- **패킷 교환 방식**은 데이터를 미리 패킷 단위로 나누어 전송하여 가변 크기의 전송이 가능하다. 

가상 회선
- 연결형 서비스를 지원하기 위한 기능으로, 패킷 교환 방식을 기반으로 전송되는 모든 패킷의 경로가 동일하다. 패킷 단위로 전송되므로 회선 교환 방식은 지원되지 않는다.

데이터그램
- 비연결형 서비스를 지원하기 위한 기능으로, 패킷 교환 방식을 기반으로 전송되는 패킷의 경로가 독립적이다. 

프레임 릴레이
- 오류 제어, 흐름 제어 과정에서 응답 프레임의 전송 횟수를 줄여 고속 데이터 전송을 지원한다. 

네트워크의 구분
- **LAN** : 소규모 지역에 위치하는 호스트로 구성된 네트워크이다. 버스형과 링형의 연결이 있는데 **버스형**은 공유 버스 하나에 여러 호스트를 연결하는 방식이고 **링형**은 호스트의 연결이 순환 구조인 방식이다. 둘 다 브로드캐스팅 방식을 지원한다.
- **MAN** : 중간 규모의 네트워크
- **WAN** : 가장 넓은 범위의 네트워크

인터네트워킹
- **인터네트워킹**이란 네트워크 간의 연결이며, 인터네트워킹 기능을 하는 시스템을 **게이트웨이**라고 한다. 게이트웨이는 보통 리피터/브리지/라우터로 구분된다. 
- 리피터는 물리 계층 기능을 지원하며 증폭시키는 역할을 한다. 
- 브리지는 데이터 링크 계층의 오류를 제어한다. 데이터 링크 계층은 MAC 계층, LLC계층으로 구분할 수 있는데 브리지는 MAC 계층의 헤더를 다른 호스트의 MAC 계층 헤더로 변형해 전송한다. 
- 라우터는 물리+데이터 링크+네트워크 계층을 지원하며 여러 LAN을 연결하여 교환 기능을 수행한다. 브리지의 라우팅 테이블에 따라 수신할 프레임을 무시할지 혹은 다른 LAN에 전달할지 결정한다. 라우팅 테이블은 LAN이 동작하면서 자동 생성되는 체계이다.
- 네트워크가 이중 경로가 생성되지 않도록 비순환 구조가 되어야 하므fh spanning tree가 적용된다. 먼저 root를 지정하여 다른 모든 브리지까지의 최단 경로 트리를 구성하도록 LAN을 구성하는 구조이다.

전송과 교환
- **교환**은 전달 경로가 둘 이상일 때 라우터에서 데이터를 어느 방향으로 전달할지 선택하는 기능이다.
- **전송**은 일대일로 직접 연결된 두 시스템간의 데이터 전송을 의미한다. 전송에는 라우팅 개념이 포함되지 않는다.

점대점 방식
- 교환 호스트가 송수신 호스트의 중간에 위치한다. 

브로드캐스팅 방식
- 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전달되어 중개 기능을 하는 교환 호스트가 없다.

멀티캐스팅
- 송신 호스트와 연결된 수신 호스트가 하나이면 **유니포인트**이고, 다수의 수신 호스트와 연결되면 **멀티포인트**가 된다. 
- 송신 호스트가 한 번 전송할 때 하나의 수신 호스트에만 데이터를 보내면 **유니캐스팅**이고, 다수의 수신 호스트에 보낼 수 있으면 **멀티캐스팅**이다. 멀티캐스트 데이터를 중개하는 라우터에서 그룹 주소를 인식하고 처리할 수 있어야 한다.

수신 호스트의 응답 프레임
- 수신 호스트의 응답 프레임은 2가지인데, 하나는 데이터 프레임이 정상적으로 도착할 경우 회신하는 **긍정 응답 프레임**이고 또 하나는 데이터 프레임이 깨졌을 경우의 **부정 응답 프레임**이다. 부정 응답 프레임일 경우 송신 호스트에서 재전송한다.

송신 호스트의 타임아웃 기능
- 송신 호스트는 데이터 프레임을 전송한 후 일정 시간 내에 수신 호스트로부터 긍정 응답 프레임이 없으면 타임아웃 기능을 통해 데이터 프레임을 재전송한다.

순서 번호 기능
- 중복 데이터를 가려내기 위해 프레임 내부에 순서 번호를 기록한다.

프레임
- 데이터 링크 계층에서 전송 데이털르 나누는 단위를 **프레임**이라고 한다.
- 프레임에는 상위 계층에서 보낸 데이터의 오류를 확인하기 위한 체크섬, 송수신 호스트의 주소, 프로토콜의 제어 코드 같은 정보가 포함된다. 
- **문자 프레임**은 문자 데이터를 전송할 때 사용된다. 하나의 프레임 단위를 구분하기 위해 프레임 앞뒤에 ASCII 코드의 특수문자를 추가한다. 시작에는 DLE,STX를 추가하고 끝에는 DLE,ETX를 추가해 구분한다. **문자 스터핑**을 사용하여 DLE 문자가 포함될 경우를 방지한다.
- **비트 프레임**은 임의의 비트 패턴 데이터를 지원하는데 플래그라는 비트 패턴을 이용해 프레임 단위를 구분한다. **비트 스터핑**을 통해 1인 패턴이 5번 발생하면 강제로 0을 추가하여 플래그 패턴과 중복되지 않도록 한다.

다항코드
- 버스트 에러 형태의 오류를 검출하는 확률이 높다.


# 데이터 링크 계층

데이터 링크 계층에서 두 호스트가 통신하려면 일대일로 직접 연결해야 한다. 여기서 두 호스트 사이의 오류 제어, 흐름 제어 기능을 제공한다. 송신 호스트에서 전송한 프레임은 점대점으로 연결된 수신 호스트에 라우팅 과정없이 전달된다.
- **멀티 드롭**방식은 하나의 호스트가 다수의 호스트와 연결된 비대칭 형태의 구조를 의미한다. 
- 전송 오류를 해결하는 과정에서 사용하는 프레임은 **정보 프레임**, **긍정 응답 프레임**, **부정 응답 프레임**이 있다.
    - 정보 프레임 : 상위 계층이 전송하려는 데이터를 수신 호스트에 전송한다. 정보 프레임을 받은 호스트는 먼저 내용이 깨졌는지 여부를 확인한다.
    - 긍정 응답 프레임 : 프레임 변형 오류가 발생하지 않으면 송신 호스트에 긍정 응답 프레임을 회신한다.
    - 부정 응답 프레임 : 프레임 변형 오류가 발생하면 송신 호스트에 부정 응답 프레임을 회신한다.

### 슬라이딩 윈도우 프로토콜

두 호스트 사이의 프레임 전송을 위한 통신 프로토콜로, 오류 제어와 흐름 제어 기능을 제공한다. 
정보 프레임을 전송할 때 데이터뿐 아니라 프레임 순서 번호, 오류 검출 코드 등을 표기하여 순차적으로 송신한다.

- 송신 윈도우 : 송신 호스트가 전송한 정보 프레임을 유지하기 위한 내부 버퍼
- 수신 윈도우 : 받은 정보 프레임을 유지하기 위한 내부 버퍼

연속형 전송
- 각 정보 프레임에 대한 긍정 응답 프레임을 받지 않고 여러 프레임을 연속으로 전송한다.
- 전송된 정보 프레임에 대한 ACK 프레임 회신 없이 다음 프레임을 전송시키는 방식은 전송 오류가 적을 경우 매우 효율적이다.
- 오류를 해결하는데는 Go-Back N 방식과 선택적 재전송 방식이 있다.

피기배킹(Piggybacking)
- 양방향 전송이 가능한 채널 방식에서 송신 호스트와 수신 호스트의 구분 없이 양방향으로 정보 프레임, 응답 프레임을 교차하여 전송할 수 있다. 정보 프레임의 구조를 조정해 응답 기능까지 함께 수행하여 전송 효율을 높이기 위한 방식이다.

### HDLC 프로토콜
- 컴퓨터가 일대일 혹은 일대다로 연결된 환경에서 데이터의 송수신 기능을 제공한다. 
- 연결된 호스트는 주국과 종국으로 구분되고 주국에서 전송되는 메시지는 명령이면, 종국응 응답으로 회신한다.


# 네트워크 계층

## MAC 계층
WAN 환경과 달리 LAN 환경에서는 데이터 링크 계층을 LLC 계층과 MAC 계층으로 나누어 처리한다.  
- **LLC 계층** : 데이터 링크 계층의 기본기능은 주로 에서 다룬다.
- **MAC 계층** : 물리적인 전송 선로의 특징 및 매체 간 연결 방식에 따른 제어 부분을 처리한다.
LAN 환경에서는 LLC 계층( 데이터 링크 계층의 주요 역할 )에 MAC 계층이 추가된 것으로 볼 수 있다.

MAC 계층에서는 전송 선로의 물리적인 특성을 반영하는데 LAN 종류에 따라 구분된다. 
이더넷에서 사용하는 **공유 버스 방식**과 **토큰 링**방식이 대표적이다. 

### IEEE 802 시리즈
- 데이터 링크 계층과 관련된 여러 LAN 표준안에 대한 연구이다.
- IEEC 802.2는 LLC 프로토콜에 대한 정의를 다루고 IEEE 802.3부터는 MAC 계층을 다룬다. IEEE 802.3은 **CSMA/CD** 방식, IEEE 802.4는 **토큰 버스** 방식, IEEE 802.5는 **토큰 링** 방식으로 규정한다.

이더넷
- IEEE 802.3은 1-persistent CSMA/CD 방식의 LAN 환경에 대한 표준안으로, 공유 버스로 연결한 호스트 간 데이터 전송에 관한 규정을 다룬다. **이더넷**은 이를 실제로 구현한 제품으로 현재는 좀 더 일반화하여 사용된다.
- 이더넷 프레임 : 계층을 거치면서 각 계층의 프로토콜이 정의한 헤더 정보를 추가해야 하는데 MAC 계층 프로토콜에 정의된 헤더와 트레일러 정보를 추가한 것을 MAC 프레임이라고 하고, 이더넷 프로토콜에서는 **이더넷 프레임**이라 한다.

## 라우팅
네트워크 계층은 기본적으로 송수신 호스트 사이의 **패킷 전달 경로를 선택하는 라우팅** 기능을 제공한다. 네트워크의 구성 형태에 대한 정보를 담은 라우팅 테이블을 이용한다.  
또한 특정 지역에 트래픽이 집중되는 혼잡을 제어하고 라우터 간 패킷 중개하는 과정에서의 패킷 분할 및 병합하는 역할을 한다.

HELLO/ECHO 패킷
- 라우터 초기화 과정에서 가장 먼저 이웃 라우터의 경로 정보를 파악해야 한다. 각 라우터는 이웃에 연결된 라우터에 HELLO 패킷을 전송해 정보를 얻고, 라우터 간 전송 지연 시간을 측정하기 위해 ECHO 패킷을 전송한다.

### 혼잡 제어
Traffic Shaping
- traffic shaping : 송신 호스트가 전송하는 패킷의 발생 빈도를 네트워크에서 예측할 수 있는 전송률로 이루어지게 하는 기능이다.
- licky bucket : 송신 호스트와 네트워크 간에 적절한 크기의 깔때기가 위치한다. 깔때기의 출구 크기는 고정되어 있어 가변적 크기의 패킷이 들어와도 고정된 크기의 패킷이 보내진다.

ECN 패킷
- 혼잡 지역의 라우터는 입력 선로로 들어온 패킷이 주의 표시된 출력 선로로 라우팅되는 경우, 패킷의 송신 호스트에 ECN 패킷을 전송한다.
- ECN 패킷을 수신한 송신 호스트는 혼잡이 발생함을 인지하여 전송 패킷의 양을 줄인다.

### 라우팅 프로토콜

- 거리 벡터 라우팅 프로토콜 : 연결된 이웃 라우터와 라우팅 정보를 교환하는 방식이다. 교환 정보는 각각의 라우터에서 개별 네트워크에 패킷을 전송하는데 거리는 거리 정보이다. 거리 벡터 알고리즘을 구현하기 위해선 링크 벡터, 거리 벡터, 다음 홉 벡터 3가지 정보를 관리해야 한다. 대표적으로 RIP 프로토콜이 있다.
- 링크 상태 라우팅 프로토콜 : 개별 라우터가 이웃하는 라우터까지의 거리 정보를 구한 후 모든 라우터에 전달한다. 거리 벡터 라우팅 프로토콜과는 반대 방식인데 링크 상태가 변할 경우 시간이 많이 소요되는 단점을 보완하였다. 대표적으로 인터넷에서 사용하는 OSPF가 있다.
- 경로 벡터 라우팅 프로토콜 : 거리 벡터 기반의 RIP 프로토콜이나 링크 상태 기반의 OSPF는 내부 라우팅 용도이다. 외부 라우팅 프로토콜에는 경로 관련 거리 정보가 필요없다. 라우터에서 어느 네트워크가 연결 가능한지만 고려한다. 대표적으로 외부 라우팅 프로토콜은 BGP가 있다.

## [ 전송 프로토콜 ] IP 프로토콜

네트워크 계층에서 전송 프로토콜로 이용되는 IP는 호스트 주소 표기나 패킷 분할에 대한 기능은 있지만 단대단 형식의 오류 제어나 흐름 제어 기능은 없다.

- 비연결형 서비스를 제공한다.
- 패킷을 분할 및 병합하는 기능을 수행하기도 한다.
- 데이터 체크섬은 제공하지 않고 헤더 체크섬만 제공한다.
- Best Effort 원칙에 따라 전송 기능을 제공하다. : 패킷이 수신 호스트에 100% 도착하는 것을 보장하지 않는다. 전송 오류 문제는 상위 계층에서 고려해야 한다.

IP 패킷의 분할
- 데이터 링크 계층에서 각 프로토콜마다 프레임의 크기가 다르다. 상위 계층에서 내려온 데이터를 IP 프로토콜에서 분할 과정을 거쳐 전송하고 수신 호스트에서 다시 합치는 병합 작업을 수행한다.

DHCP 프로토콜
- 개별 호스트에 수동으로 고정 IP를 할당할 수 있는데 IP 주소가 부족하여 DHCP로 자동으로 할당할 수 있다.
- 자동으로 할당 가능한 IP 주소는 DHCP 서버가 관리하는 풀에서 관리된다. 클라이언트로부터 IP 주소 요청이 오면 풀에서 IP 주소를 하나 할당해주고 사용이 끝나면 다시 주소를 반환한다.
- DHCP 메시지는 UDP 데이터그램에 캡슐화되어 전송되며 클라이언트의 포트는 68, DHCP 서버의 포트는 67이다.

### IPv6 프로토콜
32비트의 주소 공간을 지원하는 IPv4 프로토콜은 최대 2^32 개의 호스트를 수용할 수 있다. IPv6는 128비트로 확장하여 호스트를 최대 2^128개까지 지원 가능하다.

IPv6 헤더는 불필요한 필드를 제외하고 확장 헤더 형식으로 변경하였다. 기존의 IP 프로토콜에서 과도하게 수행되었던 오류 제어 같은 오버헤드를 줄여 전송 효율을 높이고자 한다.

### 이동 IP 프로토콜
이동 호스트가 자신의 고유 주소를 유지하면서 계속 이동하는 송수신 호스트 간의 지속적인 라우팅 처리가 중요하다.

#### IP 터널링
홈 에이전트와 이동 에이전트 사이에 터널이 설정되어, IP 패킷을 목적지까지 전송하기 위한 중간 경로를 사용한다. 송신 호스트와 수신 호스트간의 IP프로토콜과는 별도로 추가적인 IP 프로토콜을 사용해야 한다.

- HA : 이동 호스트에는 고유 IP주소인 HA( Home Address )가 할당되는데 호스트 위치가 바뀌어도 변하지 않는다. 
- COA : 이동 호스트가 위치를 변경할 때 일시적으로 할당된 IP주소이다. 이동할 때마다 새로운 COA가 할당되고 기존 COA는 회수된다.

## [ 제어 프로토콜 ]

#### ARP 프로토콜
네트워크 환경에서 호스트가 다른 호스트에 데이터를 전송하려면 IP주소 뿐 아니라 MAC 주소도 알아야 한다. 송신 호스트의 MAC 주소는 LAN 카드에서 가져온다. 수신 호스트의 MAC 주소는 수신 호스트의 IP 주소를 매개변수로 하여 ARP 프로토콜을 통해 가져온다. 

#### RARP 프로토콜
ARP와 반대로 MAC 주소를 이용해 IP 주소를 제공한다. 파일 시스템이 존재하지 않는 시스템이나 X윈도우 터미널에서는 LAN 카드에서 MAC 주소를 읽어와도 보관할 수 없다. 자신의 MAC 주소와 IP주소를 매핑하는 서버로부터 IP 주소를 가져온다. 모든 호스트에 RARP 변환 요청이 가도 해당 정보를 보관하는 RARP 서버만 응답이 온다.

#### ICMP 프로토콜
ICMP는 인터넷 환경에서 오류 처리를 담당한다. IP프로토콜은 전송 과정에서 발생하는 오류를 보고하는 기능이 없다. ICMP 프로토콜에서 오류가 발생한 IP패킷에 대해 원인을 송신 호스트에 전달한다. 

#### IGMP 프로토콜
멀티캐스트 라우팅에서 다수의 호스트를 하나의 그룹으로 관리하는 기능이 필요하다. IGMP는 멀티캐스트 그룹에 가입하거나 탈퇴할 때 사용하는 프로토콜이다.


# 전송 계층
전송 계층에서는 네트워크 양단의 통신 주체가 중간의 논리적인 선로를 통해 데이터를 주고 받는다. 이 과정에서 흐름 제어, 오류 제어, 패킷의 분할 및 병합 기능을 수행한다. 이를 지원하기 위해 전송 계층 프로토콜을 설계할 때는 주소 표현, 멀티플렉싱, 연결 관리 등에 대한 고려가 이루어져야 한다.

- 주소 표현 : 전송 계층에서는 TSAP(Transport Service Access Point)라는 주소 표현을 사용한다.
- 멀티플렉싱 : TPDU(Transport Protocol Data Unit)의 목적지가 동일한 호스트이면 하나의 가상 회선을 사용하는 것이 유리할 수 있는데 상방향 멀티플렉싱과 하방향 멀티플렉싱이 있다.
- 연결 설정 관리: Conn_Req로 연결을 요청하고 Conn_Ack 회신으로 요청을 수락한다. 연결 해제에는 한쪽에서 Disc_Req를 전송해 일방적으로 종료하는 일방적 연결 해제와 양쪽에서 Disc_Req를 전송해 종료하는 점진적 연결 해제 방식이 있다.

## TCP 프로토콜
IP 프로토콜 위에서 연결형 서비스를 지원하는 전송 계층 프로토콜이다. OS의 내부에서 구현되기에 상위 계층에서 시스템 콜이라는 프로그램 호출 방식을 이용해야 한다.
- 연결형 서비스를 제공한다.
- 전이중 방식의 양방향 가상회선이다.
- 신뢰성 있는 데이터를 전송한다.

TCP 프로토콜은 데이터를 세그먼트라는 블록 단위로 분할해서 전송한다. 세그먼트는 헤더 구조로 시작해서 전송 데이터가 따라온다.

### 혼잡 제어
ECN 기능은 혼잡을 인지한 라우터가 송신 프로세스에 명시적으로 혼잡 발생을 알려 송신 프로세스 스스로 트래픽을 완화하는 기능이다.
- TCP 헤더에 CWR 필드와 ECE 필드를 정의한다. 
    - ECE 필드 : 트래픽이 많을 때 라우터가 송신 프로세스에 혼잡을 알리기 위해 사용된다.
    - CWR 필드 : ECE 비트를 받은 송신 프로세스는 전송 윈도우 크기를 줄였음을 통지하기 위해 사용된다.
- IP 헤더의 ECN 필드를 정의한다.

ECN 기능을 사용하려면 TCP 연결 설정 단계에서 ECN 기능 사용 여부를 협상한다. 

### 포트 번호
프토 번호는 TCP, UDP가 상위 계층에 제공하는 주소 표현 방식이다. 소켓 시스템 콜을 이용해 TCP 연결 설정이 되었을 때 통신 양단의 프로세스가 IP 주소와 내부 포트 번호로 조합된 고유 주소를 사용한다.
클라이언트 - 서버의 연동은 서버가 먼저 실행되면 클라이언트가 서버와 연결을 시도한다. 연결하기 위해 서버의 IP주소와 포트 번호를 알아야 한다. 

### 데이터 전송
TCP는 전이중 방식의 양방향 통신을 지원하므로 가상 회선으로 연결된 두 프로세스가 동시에 데이터를 전송 가능하다.  
데이터를 전송하기 위해 아래의 3가지 단계가 이루어져야 한다.
1. 연결 설정 : three-way handshake를 따른다.
2. 데이터 전송 : 슬라이딩 윈도우 프로토콜로 흐름 제이르르 지원한다.
3. 연결 헤제 : 양쪽의 합의 하에 이루어진다.

## UDP 프로토콜
하부의 IP 프로토콜을 이용해 비연결형 서비스를 지원하면 빠른 전송 가능하다.
- 헤더와 전송 데이터에 대한 체크섬 기능을 제공한다.
- Best Effort 원칙을 따라 데이터그램이 목적지에 도착하는 것을 보장하진 않는다.
- 각 데이터그램은 전송 과정에서 독립적으로 중개된다. 
- 슬라이딩 윈도우 프로토콜 같은 흐름 제어 기능이 없어, 버퍼 오버플로에 의한 데이터 분실 오류에 대한 가능성이 있다.

## RTP 프로토콜
음성, 영상 같은 정보를 실시간으로 서비스하면 데이터 그램 변형 및 분실 오류에 대한 복구 기능이 상대적으로 덜 중요하다. 대신 데이터그램의 도착 순서, 수신한 패킷의 지터 분포의 균일성, 데이터 압축을 통한 전송량의 최소화가 중요해진다.
TCP, UCP는 실시간 전송에 적합하지 않지만 RTP는 UDP에 데이터그램의 순서 번호 기능을 추가하여 실시간 데이터 전송을 지원한다. 이를 위해 전송 환경에서 버퍼와 지터라는 변수를 고려하다.
- 불규칙한 도착 순서를 정렬하기 위해 타임스탬프 방식이 적용된다.
- (지연) 버퍼 : 시간 간격이 가변적인 데이터를 지연 버퍼를 통해 일정한 간격으로 보정하여 전송한다.
- 지터 : 지터 분포는 데이터 그램의 도착시간이 일정하지 않고 불규칙하게 도착한 정도를 나타낸다.


### RTP의 데이터 전송
RTP는 UDP 위에서 구현된다. 
- 데이터 그램 분실이나 도착 순서 변경 같은 전송 오류는 RTP 자체에서 해결한다.
- UDP에서 제공하는 포트 주소를 사용해 송수신 프로세스 간 연결을 관리한다.
- 기능별로 구현하여 모듈이 완성되는 형시깅다.

### RTCP 프로토콜
RTP 제어 프로토콜이다. 전송 프로토콜은 세션 참가자 사이의 멀티캐스트 기능을 이용하여 전송을 담당하지만 RTCP는 제어 관련 기능을 수행한다.
마찬가지로 UDP를 하부 계층으로 사용한다.

## OSI TP 프로토콜
OSI에서 정의한 TP(Transport Protocol)는 5개의 클래스로 분류하여 지원한다.
- class 0 : 기본 기능, 단일 포트 지원
- class 1 : 패킷 손실 같은 기본 오류 복구 기능 추가, 단일 포트 지원
- class 2 : 멀티플렉싱 지원
- class 3 : 멀티플랙싱 지원, 기본 오류 복구 기능
- class 4 : 멀티플렉싱 지원, 오류 검출 및 복구 기능 

## 소켓
소켓은 보통 AF_UNIX와 AF_INET 주소 체계를 많이 사용한다. 
- AF_UNIX로 표시되는 유닉스 주소 체계는 한 호스트 내에서 실행되는 프로세스 간의 통신을 지원한다. 주소는 파일 시스템의 경로명을 기반으로 한다.
- AF_INET은 서로 다른 호스트에서 실행되는 호스트의 프로세스 간의 통신을 지원한다.

### 서비스 유형
소켓은 서비스 종류에 따라 유형이 다양하다. 소켓 유형 중 SOCK_STREAM은 연결형 서비스를 제공할 때 사용하고, SOCK_DGRAM은 비연결형 서비스에서 사용한다. 
자주 사용되지 않는 SOCK_RAW는 IP 프로토콜을 사용해 통신한다.

### INADDR_ANY
여러 컴퓨터에서 실행되는 경우, 각 실행 파일에 개별 IP주소를 지정하여 컴파일하기는 현실적으로 어렵다. INADDR_ANY라는 호스트 주소 표기 방법을 제공한다.

### 주소변환
**바이트 순서**  
컴퓨터마다 정수형 데이터를 저장하는 기억 장소 공간의 바이트 순서가 다를 수 있다. 데이터를 전송하기 전에 개별 컴퓨터의 바이트 순서를 네트워크 바이트 순서로 변환해야 한다. htonl()과 htons()는 컴퓨터 바이트 순서 -> 네트워크 바이트 순서로 변환하고 ntohl()과 ntohs()는 네트워크 바이트 순서 -> 컴퓨터 바이트 순서로 변환한다.

**표시 형식**  
인터넷 주소는 211.223.201.30 형식의 십진수로 표기하는데 컴퓨터 내부에서는 32비트의 이진수 방식으로 처리하므로 십진수-이진수 간의 변한 기능이 필요하다. 

### 연결형 vs 비연결형 서비스
- 연결형 서비스에서는 클라이언트 요청을 받으려면 accept()에서 대기해야 한다. 클라이언트에서 connect() 요청이 발생하면 연결이 설정된다.
- 비연결형 서비스에서는 데이터 송수신을 위한 send(), recv() 대신 sendto(), recvfrom()를 사용한다. 전송 데이터마다 송신자의 소켓 주소를 함께 전송한다.

# 상위 계층
세션 계층 + 표현 계층 + 응용 계층의 긴ㅇ을 보통 하나의 프로그램으로 묶어 구현한다.(ex. telnet, FTP, 전자메일)

## 세션 계층
세션 계층 프로토콜이 상위 계층에 제공하는 기능은 세션 연결의 설정 및 해제, 세션 메시지 전송 등이 있다. 
- 세션 계층에서 중요한 기능은 syncronization(동기) 문제를 처리하는 것이다. 

### 동기점
동기점을 설정하는 이유는 메시지 전송 과정에서 발생하는 오류를 복구하기 위함이다. 동기점이 설정된 시점 이전까지는 통신 양단이 서로 완벽하게 합의하였음을 의미한다.
- 동기점은 데이터를 전송할 때 특정 지점에서 복구할 수 있기 위한 통신 양단 간의 합의점이다.
- 재동기 : 상위 계층에는 적절한 구간으로 나뉜 지점에 동기점을 부여하고, 오류가 발생하면 해당 지점으로 복구한다.
- 동기점을 주동기점과 부동기점으로 나뉘어진다.
    - 주동기 : 두 세션 프로세스 사이에 교환되는 대화의 한 단위가 완료되는 지점에서 설정
    - 부동기 : 대화 단위 내의 작은 부분에서 설정

## 표현 계층
표현 계층은 응용 프로세스 사이에 전송되는 메시지의 표현 방법을 다룬다. 
- 컴퓨터에서 사용하는 데이터 표현 규칙인 추상문법을 네트워크 전체에서 일관성 있는 표현 규칙인 전송 문법으로 변환하여 전송한다.

### 데이터 압축
대용량 데이터는 압축하여 크기를 줄인 후 전송하는 것이 속도 면에서 유리하다. 압축 정도는 데이터의 패턴에 영향을 받는데 중복 정보가 많을 수록 압축률이 높다. 
데이터를 압축하는 유형에는 비손실 압축과 손실 압축이 있다. 비손실 압축은 압축 과정에서 원본 데이터의 내용이 분실되지 않으나 손실 압축은 압축 해제 후 원래 데이터의 크기와 동일하지 않다.
손실 압축은 압축 데이터의 크기가 작기에 전송 효율이 더 높다.

## 응용 계층
신뢰성 있는 데이터 전송을 보장하고자 한다.

### 클라이언트 - 서버 모델

하나의 서버 프로그램이 다수의 클라이언트에 응용 서비스를 제공한다.  
클라이언트와 서버 간의 네트워크 연결은 전송 계층의 포트 연결로 구현된다.

### 상태 정보
연결형 서비스는 클라이언트와 서버 사이의 연결로 둘 사이의 현재 상태라는 개념이 존재한다.  
일반적으로 연결 설정과 관련된 정보가 있고, 내부적으로 클라이언트와 서버가 논리적으로 하나의 단위로 처리해야 하는 작업을 한번에 처리하지 못하고 나누어 처리하는 경우의 정보가 있다.

### 동시성 제어
동시성 제어는 여러 작업의 선후에 상관없이 동시에 실행되어도 각 실행결과가 항상 같은 결과를 제공하도록 한다.  
클라이언트 - 서버 환경에서 동시성은 서버 하나가 여러 클라이언트를 동시에 서비스하는 경우가 있다.
